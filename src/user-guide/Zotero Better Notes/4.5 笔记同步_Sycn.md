4.5 笔记同步/Sycn

插件v0.8.x及以后版本支持Zotero笔记与Markdown文件的双向同步。在此之前的旧版本仅支持笔记->Markdown的覆盖性单向同步。强烈建议使用新版本。

💡如果只需要导出一次，没有同时在Zotero笔记与Markdown中同时编辑的需求，则建议仅仅选择导出而非同步。

# 设置同步

三种方式触发笔记同步：

1.  在工作区菜单栏=>文件=>同步主笔记或Ctrl+Shift+S；
2.  在笔记编辑器中，点击右上角导出按钮，导出时勾选“修改时自动同步到导出路径”（仅在“导出链接的子笔记为markdown文件”也勾选时有效）。
3.  在库视图中，选择数个笔记条目，右键菜单栏点击“导出笔记及子笔记”，然后在“设为同步”时点击确认。

<img src="https://cdn.nlark.com/yuque/0/2022/png/32594373/1670208156061-86d15413-900d-4098-83b3-918fecd66e9d.png" width="256" id="uc2857c5d" class="ne-image">

<img src="https://cdn.nlark.com/yuque/0/2022/png/32594373/1670208183220-845ed0c8-dfb1-47f2-ba64-a9f47b5a7b4c.png" width="402" id="u7722507b" class="ne-image">

<img src="https://cdn.nlark.com/yuque/0/2022/png/32594373/1670208251723-2417efab-3ce8-468f-9747-e007b7379709.png" width="329.5" id="u084bba3d" class="ne-image">

此时，Zotero内修改的内容会同步到最新的导出路径。

笔记处于同步状态时，点击导出会由同步状态窗口替代导出窗口：

<img src="https://cdn.nlark.com/yuque/0/2022/png/32594373/1662110730812-80a9899c-07ac-43dc-b4d9-8c7509801212.png" width="478" id="uc1d51315" class="ne-image">

点击“导出为”可打开原本的导出窗口。

# 同步管理

在上述同步状态窗口点击“同步管理”，或在菜单栏=>文件=>Better Notes同步管理可打开同步管理窗口。

<img src="https://cdn.nlark.com/yuque/0/2022/png/32594373/1670208352089-b6e7e5a8-b3bc-4fc8-a7b1-0435cd5aecf0.png" width="602" id="u9af41684" class="ne-image">

此处可选中笔记，手动检查同步，修改同步路径或取消同步。在取消同步时，若选择“应用于关联笔记”，则所做操作还会一并应用于被选中笔记链接的其他笔记，即使它们目前未被同步。

# 同步触发

同步检查有多种可能触发：

1.  Zotero笔记产生编辑时，添加后台任务自动对编辑的笔记进行同步检查；
2.  用户点击同步窗口中的“同步”按钮，对当前笔记或全部设置同步的笔记进行同步检查；
3.  Zotero主窗口存在于前台且激活时（即，当前选中的窗口是Zotero），定期对全部设置同步的笔记进行同步检查。

请注意同步检查并不意味着触发一次同步。仅当检测到外部Markdown或笔记产生修改时，才会开始同步。

在上述同步管理窗口中可设置自动同步周期，默认为30s。如果设置数值小于0，则不会自动同步。

# 差异合并（Diff-Merge）

绝大多数情况下，笔记与Markdown的编辑能够自动同步。如果自从上一次同步以来，Zotero笔记与外部Markdown文件都进行了编辑，则可能会进入差异合并阶段。

在此时，会弹出差异合并窗口，由用户手动选择需要保留的编辑。

<img src="https://cdn.nlark.com/yuque/0/2022/png/32594373/1670425425669-52052256-ea2f-47d3-9c69-c391de5722b1.png" width="902" id="ucf71c2f1" class="ne-image">

上方信息栏显示当前正在比较的笔记及对应Markdown文件信息；

左侧是修改选择栏，可以多选数个要接受的编辑。中间为笔记的HTML（raw）格式的差异比较，红色为相较上次同步后笔记内删除的内容，绿色为相较上次同步后笔记内新增的内容。右侧为实时预览栏，根据左侧修改选择的情况实时预览编辑合并后的笔记。

点击Finish来保存合并，点击Unsync将会取消合并并且不再同步该笔记，点击Skip跳过本次比较。